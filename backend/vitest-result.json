[dotenv@17.2.3] injecting env (47) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }
{"numTotalTestSuites":48,"numPassedTestSuites":24,"numFailedTestSuites":24,"numPendingTestSuites":0,"numTotalTests":69,"numPassedTests":49,"numFailedTests":19,"numPendingTests":1,"numTodoTests":0,"snapshot":{"added":0,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0,"didUpdate":false},"startTime":1771930304477,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["admin invites"],"fullName":"admin invites can create, list, and revoke invites","status":"failed","title":"can create, list, and revoke invites","duration":2190.868199999968,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.user.create()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:286:36\n\n  283   createdBy: admin._id,\n  284 });\n  285 \nΓåÆ 286 const pgMediator = await db.user.create(\nUnique constraint failed on the fields: (`mobile`)\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:286:22)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/admin.invites.spec.ts:28:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930632202,"endTime":1771930634392.8682,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/admin.invites.spec.ts"},{"assertionResults":[{"ancestorTitles":["ai routes"],"fullName":"ai routes exposes status and rejects invalid tokens","status":"passed","title":"exposes status and rejects invalid tokens","duration":274.66599999999744,"failureMessages":[],"meta":{}},{"ancestorTitles":["ai routes"],"fullName":"ai routes validates payloads before calling the AI service","status":"passed","title":"validates payloads before calling the AI service","duration":434.4175000000105,"failureMessages":[],"meta":{}},{"ancestorTitles":["ai routes"],"fullName":"ai routes returns 503 with a stable error code when Gemini is not configured","status":"passed","title":"returns 503 with a stable error code when Gemini is not configured","duration":512.1596999999892,"failureMessages":[],"meta":{}},{"ancestorTitles":["ai routes"],"fullName":"ai routes validates verify-proof payload","status":"failed","title":"validates verify-proof payload","duration":4591.611600000004,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/ai.routes.spec.ts:86:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["ai routes"],"fullName":"ai routes validates extract-order payload and returns 503 when Gemini is not configured","status":"failed","title":"validates extract-order payload and returns 503 when Gemini is not configured","duration":5388.334799999982,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/ai.routes.spec.ts:106:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930506723,"endTime":1771930517924.3347,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/ai.routes.spec.ts"},{"assertionResults":[{"ancestorTitles":["AI Service","generateChatUiResponse"],"fullName":"AI Service generateChatUiResponse should handle chat request without API key gracefully","status":"passed","title":"should handle chat request without API key gracefully","duration":5.127199999988079,"failureMessages":[],"meta":{}},{"ancestorTitles":["AI Service","generateChatUiResponse"],"fullName":"AI Service generateChatUiResponse should return structured response for greeting","status":"passed","title":"should return structured response for greeting","duration":1683.3796000000439,"failureMessages":[],"meta":{}},{"ancestorTitles":["AI Service","generateChatUiResponse"],"fullName":"AI Service generateChatUiResponse should identify search intent","status":"passed","title":"should identify search intent","duration":2346.1935999999987,"failureMessages":[],"meta":{}},{"ancestorTitles":["AI Service","generateChatUiResponse"],"fullName":"AI Service generateChatUiResponse should handle empty message gracefully","status":"passed","title":"should handle empty message gracefully","duration":1352.5643000000273,"failureMessages":[],"meta":{}},{"ancestorTitles":["AI Service","verifyProofWithAi"],"fullName":"AI Service verifyProofWithAi should fall back to OCR verification when API key is missing","status":"passed","title":"should fall back to OCR verification when API key is missing","duration":53.10350000002654,"failureMessages":[],"meta":{}},{"ancestorTitles":["AI Service","verifyProofWithAi"],"fullName":"AI Service verifyProofWithAi should return structured verification result","status":"passed","title":"should return structured verification result","duration":3183.4737000000314,"failureMessages":[],"meta":{}},{"ancestorTitles":["AI Service","verifyProofWithAi"],"fullName":"AI Service verifyProofWithAi should handle invalid base64 gracefully","status":"skipped","title":"should handle invalid base64 gracefully","failureMessages":[],"meta":{}}],"startTime":1771930635800,"endTime":1771930644424.4736,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/ai.spec.ts"},{"assertionResults":[{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites registers a shopper via invite and consumes the invite","status":"passed","title":"registers a shopper via invite and consumes the invite","duration":14534.685899999999,"failureMessages":[],"meta":{}},{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites registers a mediator via invite and consumes the invite","status":"passed","title":"registers a mediator via invite and consumes the invite","duration":11396.354300000003,"failureMessages":[],"meta":{}},{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites registers a mediator via agency code when invite is not found","status":"passed","title":"registers a mediator via agency code when invite is not found","duration":9133.3603,"failureMessages":[],"meta":{}},{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites registers a brand via invite and consumes the invite","status":"passed","title":"registers a brand via invite and consumes the invite","duration":10748.101200000005,"failureMessages":[],"meta":{}},{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites registers a shopper via mediator code when invite is not found","status":"passed","title":"registers a shopper via mediator code when invite is not found","duration":10074.224499999997,"failureMessages":[],"meta":{}},{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites registers an agency via invite and creates an Agency record","status":"passed","title":"registers an agency via invite and creates an Agency record","duration":10755.448400000008,"failureMessages":[],"meta":{}},{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites rejects expired invites and does not create a user","status":"passed","title":"rejects expired invites and does not create a user","duration":9200.4191,"failureMessages":[],"meta":{}},{"ancestorTitles":["auth registration + invites"],"fullName":"auth registration + invites enforces maxUses (replay-safe): second registration fails and user is not created","status":"passed","title":"enforces maxUses (replay-safe): second registration fails and user is not created","duration":11695.482900000003,"failureMessages":[],"meta":{}}],"startTime":1771930310012,"endTime":1771930397551.483,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/auth.register.spec.ts"},{"assertionResults":[{"ancestorTitles":["auth"],"fullName":"auth logs in and calls /me","status":"failed","title":"logs in and calls /me","duration":4751.293799999985,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/auth.spec.ts:20:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["auth"],"fullName":"auth allows profile update when optional fields are blank","status":"failed","title":"allows profile update when optional fields are blank","duration":9355.472600000037,"failureMessages":["AssertionError: expected 400 to be 200 // Object.is equality\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/auth.spec.ts:60:29\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930570664,"endTime":1771930584771.4727,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/auth.spec.ts"},{"assertionResults":[{"ancestorTitles":["malformed JSON handling"],"fullName":"malformed JSON handling returns 400 BAD_JSON for malformed JSON bodies","status":"passed","title":"returns 400 BAD_JSON for malformed JSON bodies","duration":33.83519999997225,"failureMessages":[],"meta":{}}],"startTime":1771930655659,"endTime":1771930655692.8352,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/bad-json.spec.ts"},{"assertionResults":[{"ancestorTitles":["brand payouts + ledger"],"fullName":"brand payouts + ledger records payout and shows it in /brand/transactions","status":"passed","title":"records payout and shows it in /brand/transactions","duration":16924.494799999986,"failureMessages":[],"meta":{}}],"startTime":1771930603182,"endTime":1771930620106.4949,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/brand.payouts.spec.ts"},{"assertionResults":[{"ancestorTitles":["ops campaigns: assign slots"],"fullName":"ops campaigns: assign slots rejects empty/zero allocations and only locks after a real assignment","status":"failed","title":"rejects empty/zero allocations and only locks after a real assignment","duration":4380.566200000001,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/campaign.assign-slots.spec.ts:31:20\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["ops campaigns: assign slots"],"fullName":"ops campaigns: assign slots prevents agencies from assigning to non-active mediators","status":"passed","title":"prevents agencies from assigning to non-active mediators","duration":11218.65750000003,"failureMessages":[],"meta":{}}],"startTime":1771930586158,"endTime":1771930601756.6575,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/campaign.assign-slots.spec.ts"},{"assertionResults":[{"ancestorTitles":["CORS origin enforcement"],"fullName":"CORS origin enforcement rejects requests with a disallowed Origin header","status":"passed","title":"rejects requests with a disallowed Origin header","duration":13.663899999985006,"failureMessages":[],"meta":{}},{"ancestorTitles":["CORS origin enforcement"],"fullName":"CORS origin enforcement allows requests with an allowed Origin header","status":"passed","title":"allows requests with an allowed Origin header","duration":229.3479000000516,"failureMessages":[],"meta":{}},{"ancestorTitles":["CORS origin enforcement"],"fullName":"CORS origin enforcement normalizes entries with trailing slashes/paths/quotes","status":"passed","title":"normalizes entries with trailing slashes/paths/quotes","duration":312.64789999998175,"failureMessages":[],"meta":{}}],"startTime":1771930651577,"endTime":1771930652135.648,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/cors.origins.spec.ts"},{"assertionResults":[{"ancestorTitles":["ops deals: publish"],"fullName":"ops deals: publish allows mediator to publish when campaign has a slot assignment (even if allowedAgencyCodes is missing)","status":"failed","title":"allows mediator to publish when campaign has a slot assignment (even if allowedAgencyCodes is missing)","duration":4357.198399999994,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/deals.publish.spec.ts:31:20\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["ops deals: publish"],"fullName":"ops deals: publish allows publishing with commission omitted (defaults to 0)","status":"failed","title":"allows publishing with commission omitted (defaults to 0)","duration":5314.301000000007,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/deals.publish.spec.ts:109:20\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["ops deals: publish"],"fullName":"ops deals: publish rejects publishing when buyer discount exceeds agency commission","status":"failed","title":"rejects publishing when buyer discount exceeds agency commission","duration":5332.350600000005,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/deals.publish.spec.ts:187:20\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930490335,"endTime":1771930505338.3506,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/deals.publish.spec.ts"},{"assertionResults":[{"ancestorTitles":["error handler production behavior"],"fullName":"error handler production behavior does not leak exception messages in production","status":"passed","title":"does not leak exception messages in production","duration":19.947700000018813,"failureMessages":[],"meta":{}},{"ancestorTitles":["error handler production behavior"],"fullName":"error handler production behavior includes exception messages in non-production for debugging","status":"passed","title":"includes exception messages in non-production for debugging","duration":10.8747999999905,"failureMessages":[],"meta":{}}],"startTime":1771930660386,"endTime":1771930660416.8748,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/errors.production.spec.ts"},{"assertionResults":[{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts Amazon order ID and amount from a rendered image","status":"passed","title":"extracts Amazon order ID and amount from a rendered image","duration":2484.7677999999723,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts Flipkart order ID from a rendered image","status":"passed","title":"extracts Flipkart order ID from a rendered image","duration":1195.9902999999758,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) returns low confidence for blank/unreadable images","status":"passed","title":"returns low confidence for blank/unreadable images","duration":9156.059999999998,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) handles a large phone-screenshot-sized image without rejecting","status":"passed","title":"handles a large phone-screenshot-sized image without rejecting","duration":2149.3632999999973,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts Meesho order ID and amount","status":"passed","title":"extracts Meesho order ID and amount","duration":1280.2458000000042,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts Myntra order ID","status":"passed","title":"extracts Myntra order ID","duration":970.4171999999962,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts from desktop-style wide screenshot","status":"passed","title":"extracts from desktop-style wide screenshot","duration":1269.0499999999884,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) handles Indian comma format and picks \"Amount Paid\" over MRP","status":"passed","title":"handles Indian comma format and picks \"Amount Paid\" over MRP","duration":1381.8352000000014,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts product name from Amazon order screenshot","status":"passed","title":"extracts product name from Amazon order screenshot","duration":1726.0445999999938,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts Nykaa beauty product name","status":"passed","title":"extracts Nykaa beauty product name","duration":1314.306099999987,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts Blinkit grocery product name","status":"passed","title":"extracts Blinkit grocery product name","duration":1338.1526000000013,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts AJIO fashion product name","status":"passed","title":"extracts AJIO fashion product name","duration":1522.4799000000057,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) rejects URL as product name","status":"passed","title":"rejects URL as product name","duration":894.5368000000017,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) rejects delivery status as product name","status":"passed","title":"rejects delivery status as product name","duration":931.9000999999989,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) rejects category list as product name","status":"passed","title":"rejects category list as product name","duration":916.826699999976,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) extracts Meesho product name correctly","status":"passed","title":"extracts Meesho product name correctly","duration":1172.7011999999813,"failureMessages":[],"meta":{}},{"ancestorTitles":["order extraction (Tesseract fallback)"],"fullName":"order extraction (Tesseract fallback) rejects address/pincode as product name","status":"passed","title":"rejects address/pincode as product name","duration":1225.0829000000085,"failureMessages":[],"meta":{}}],"startTime":1771930519315,"endTime":1771930550248.083,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/extraction.spec.ts"},{"assertionResults":[{"ancestorTitles":["health"],"fullName":"health GET /api/health returns ok","status":"passed","title":"GET /api/health returns ok","duration":212.90019999997457,"failureMessages":[],"meta":{}},{"ancestorTitles":["health"],"fullName":"health echoes X-Request-Id when provided","status":"passed","title":"echoes X-Request-Id when provided","duration":208.94039999996312,"failureMessages":[],"meta":{}}],"startTime":1771930653784,"endTime":1771930654205.9404,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/health.spec.ts"},{"assertionResults":[{"ancestorTitles":["admin invites delete"],"fullName":"admin invites delete allows admin to delete an unused active invite code","status":"failed","title":"allows admin to delete an unused active invite code","duration":3316.67220000003,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.user.create()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:347:35\n\n  344   createdBy: admin._id,\n  345 });\n  346 \nΓåÆ 347 const pgShopper = await db.user.create(\nUnique constraint failed on the fields: (`mobile`)\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:347:21)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/invites.delete.spec.ts:26:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930627589,"endTime":1771930630905.672,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/invites.delete.spec.ts"},{"assertionResults":[{"ancestorTitles":["mediator pending approval flow"],"fullName":"mediator pending approval flow mediator joins via agency code ΓåÆ pending ΓåÆ agency approves ΓåÆ mediator can login","status":"failed","title":"mediator joins via agency code ΓåÆ pending ΓåÆ agency approves ΓåÆ mediator can login","duration":4328.335800000001,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at setup (C:/Users/Gaurav/Buzzma/MOBO/backend/tests/mediator.pending-approval.spec.ts:16:18)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/mediator.pending-approval.spec.ts:28:38\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["mediator pending approval flow"],"fullName":"mediator pending approval flow prevents non-parent agencies from approving mediators","status":"failed","title":"prevents non-parent agencies from approving mediators","duration":4247.542400000006,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.user.create()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:347:35\n\n  344   createdBy: admin._id,\n  345 });\n  346 \nΓåÆ 347 const pgShopper = await db.user.create(\nUnique constraint failed on the fields: (`mobile`)\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:347:21)\n    at setup (C:/Users/Gaurav/Buzzma/MOBO/backend/tests/mediator.pending-approval.spec.ts:16:18)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/mediator.pending-approval.spec.ts:109:38\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930551663,"endTime":1771930560239.5425,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/mediator.pending-approval.spec.ts"},{"assertionResults":[{"ancestorTitles":["connectMongo placeholder handling"],"fullName":"connectMongo placeholder handling uses in-memory Mongo when MONGODB_URI contains REPLACE_ME in non-production","status":"passed","title":"uses in-memory Mongo when MONGODB_URI contains REPLACE_ME in non-production","duration":139.68450000003213,"failureMessages":[],"meta":{}}],"startTime":1771930658856,"endTime":1771930658995.6846,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/mongoPlaceholder.spec.ts"},{"assertionResults":[{"ancestorTitles":["order step verification (purchase vs review/rating)"],"fullName":"order step verification (purchase vs review/rating) keeps order UNDER_REVIEW when purchase verified but review proof missing, then approves after review verified","status":"passed","title":"keeps order UNDER_REVIEW when purchase verified but review proof missing, then approves after review verified","duration":33111.489,"failureMessages":[],"meta":{}},{"ancestorTitles":["order step verification (purchase vs review/rating)"],"fullName":"order step verification (purchase vs review/rating) keeps order UNDER_REVIEW when purchase verified but rating proof missing, then approves after rating verified","status":"passed","title":"keeps order UNDER_REVIEW when purchase verified but rating proof missing, then approves after rating verified","duration":30907.24590000001,"failureMessages":[],"meta":{}}],"startTime":1771930398976,"endTime":1771930462995.2458,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/order.step-verification.spec.ts"},{"assertionResults":[{"ancestorTitles":["core flows: products -> redirect -> order -> claim -> ops verify/settle -> brand payout/connect"],"fullName":"core flows: products -> redirect -> order -> claim -> ops verify/settle -> brand payout/connect supports end-to-end API flow (minimal assertions, contract-focused)","status":"failed","title":"supports end-to-end API flow (minimal assertions, contract-focused)","duration":15429.771600000007,"failureMessages":["AssertionError: expected 404 to be 201 // Object.is equality\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/orders.products.ops.brand.spec.ts:77:32\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930464379,"endTime":1771930479808.7715,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/orders.products.ops.brand.spec.ts"},{"assertionResults":[{"ancestorTitles":["RBAC policy (route guards + ownership)"],"fullName":"RBAC policy (route guards + ownership) enforces key route-level role gates","status":"failed","title":"enforces key route-level role gates","duration":2531.934900000022,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.user.create()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:286:36\n\n  283   createdBy: admin._id,\n  284 });\n  285 \nΓåÆ 286 const pgMediator = await db.user.create(\nUnique constraint failed on the fields: (`mobile`)\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:286:22)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/rbac.policy.spec.ts:38:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["RBAC policy (route guards + ownership)"],"fullName":"RBAC policy (route guards + ownership) enforces shopper ownership on order listing","status":"failed","title":"enforces shopper ownership on order listing","duration":5236.3822999999975,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/rbac.policy.spec.ts:156:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930481230,"endTime":1771930488998.3823,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/rbac.policy.spec.ts"},{"assertionResults":[{"ancestorTitles":["realtime health"],"fullName":"realtime health GET /api/realtime/health returns ok","status":"passed","title":"GET /api/realtime/health returns ok","duration":19.625800000037998,"failureMessages":[],"meta":{}},{"ancestorTitles":["realtime health"],"fullName":"realtime health GET /api/realtime/stream requires auth","status":"passed","title":"GET /api/realtime/stream requires auth","duration":34.69160000002012,"failureMessages":[],"meta":{}}],"startTime":1771930657272,"endTime":1771930657326.6917,"status":"passed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/realtime.health.spec.ts"},{"assertionResults":[{"ancestorTitles":["admin seeding"],"fullName":"admin seeding seeds the admin user and allows username/password login","status":"failed","title":"seeds the admin user and allows username/password login","duration":4391.829700000002,"failureMessages":["AssertionError: expected 400 to be 200 // Object.is equality\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/seed.admin.spec.ts:36:29\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930645795,"endTime":1771930650186.8296,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/seed.admin.spec.ts"},{"assertionResults":[{"ancestorTitles":["api smoke"],"fullName":"api smoke serves health and core protected endpoints","status":"failed","title":"serves health and core protected endpoints","duration":4820.761100000003,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/smoke.spec.ts:22:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930621444,"endTime":1771930626264.761,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/smoke.spec.ts"},{"assertionResults":[{"ancestorTitles":["tickets routes"],"fullName":"tickets routes allows shopper to create/list/update own ticket; blocks other shoppers; admin can list all","status":"failed","title":"allows shopper to create/list/update own ticket; blocks other shoppers; admin can list all","duration":2449.2139000000025,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.user.create()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:286:36\n\n  283   createdBy: admin._id,\n  284 });\n  285 \nΓåÆ 286 const pgMediator = await db.user.create(\nUnique constraint failed on the fields: (`mobile`)\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:286:22)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/tickets.routes.spec.ts:31:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["tickets routes"],"fullName":"tickets routes allows deleting tickets only after resolved/rejected","status":"failed","title":"allows deleting tickets only after resolved/rejected","duration":5245.055099999998,"failureMessages":["PrismaClientKnownRequestError: \nInvalid `db.mediatorProfile.upsert()` invocation in\nC:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:30\n\n  96 const mediatorCode = String(user?.mediatorCode ?? '').trim();\n  97 if (!mediatorCode) throw new AppError(409, 'MISSING_MEDIATOR_CODE', 'Mediator user is missing a code');\n  98 \nΓåÆ 99 await db.mediatorProfile.upsert(\nForeign key constraint violated on the constraint: `mediator_profiles_userId_fkey`\n    at zr.handleRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:8172)\n    at zr.handleAndLogRequestError (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7467)\n    at zr.request (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:65:7174)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at a (C:\\Users\\Gaurav\\Buzzma\\MOBO\\node_modules\\@prisma\\client\\runtime\\client.js:75:5816)\n    at ensureRoleDocumentsForUser (C:/Users/Gaurav/Buzzma/MOBO/backend/services/roleDocuments.ts:99:5)\n    at seedE2E (C:/Users/Gaurav/Buzzma/MOBO/backend/seeds/e2e.ts:395:3)\n    at C:/Users/Gaurav/Buzzma/MOBO/backend/tests/tickets.routes.spec.ts:91:5\n    at file:///C:/Users/Gaurav/Buzzma/MOBO/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}}],"startTime":1771930561576,"endTime":1771930569270.0552,"status":"failed","message":"","name":"C:/Users/Gaurav/Buzzma/MOBO/backend/tests/tickets.routes.spec.ts"}]}
